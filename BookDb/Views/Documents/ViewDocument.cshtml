@model BookDb.Models.Document

@{
    ViewData["Title"] = "Xem tài liệu";
    string mode = ViewBag.Mode ?? "original";
    var currentPage = ViewBag.Page as BookDb.Models.DocumentPage;
    int page = ViewBag.CurrentPage ?? 1;
    int totalPages = ViewBag.TotalPages ?? 0;
}

<h2>@Model.Title</h2>
<p>
    <b>Tác giả:</b> @Model.Author <br />
    <b>Lĩnh vực:</b> @Model.Category <br />
    <b>Ngày tạo:</b> @Model.CreatedAt.ToString("dd/MM/yyyy") <br />
    <b>Mô tả:</b> @Model.Description
</p>

<!-- Nút chuyển đổi giữa bản gốc và bản phân trang -->
<div class="mb-3">
    @if (mode == "paged")
    {
        <a asp-action="ViewDocument" asp-route-id="@Model.Id" asp-route-mode="original" class="btn btn-info">
            Xem bản gốc
        </a>
    }
    else
    {
        <a asp-action="ViewDocument" asp-route-id="@Model.Id" asp-route-mode="paged" class="btn btn-info">
            Xem bản phân trang
        </a>
    }
</div>

<!-- Hiển thị PDF -->
@if (mode == "paged")
{
    if (Model.Pages != null && Model.Pages.Any())
    {
        var currentPageDoc = Model.Pages
            .OrderBy(p => p.PageNumber)
            .FirstOrDefault(p => p.PageNumber == page);

        if (currentPageDoc != null)
        {
            <iframe src="@Url.Content(currentPageDoc.FilePath)" 
                    width="60%" height="1200px" style="border:1px solid #ccc"></iframe>


            <form asp-controller="Bookmarks" asp-action="Create" method="post" style="display:inline">
            <input type="hidden" name="documentPageId" value="@currentPage.Id" />
            <button type="submit" class="btn btn-primary">⭐Thêm Bookmark</button>
            </form>
            
            <!-- Nút chuyển trang -->
            <div class="mt-2">
                @if (page > 1)
                {
                    <a asp-action="ViewDocument" asp-route-id="@Model.Id" asp-route-mode="paged" asp-route-page="@(page - 1)" class="btn btn-secondary">
                        ← Trang trước
                    </a>
                }
                @if (page < totalPages)
                {
                    <a asp-action="ViewDocument" asp-route-id="@Model.Id" asp-route-mode="paged" asp-route-page="@(page + 1)" class="btn btn-secondary">
                        Trang sau →
                    </a>
                }
            </div>
        }
        else
        {
            <p class="text-danger">Trang không tồn tại.</p>
        }
    }
    else
    {
        <p class="text-danger">Tài liệu chưa được phân trang.</p>
    }
}
else
{
    if (!string.IsNullOrEmpty(Model.FilePath))
    {
        <iframe src="@Url.Content(Model.FilePath)" width="60%" height="1200px" style="border:1px solid #ccc"></iframe>
    }
    else
    {
        <p class="text-danger">Không tìm thấy file gốc.</p>
    }
}

<p class="mt-3">
    <a asp-action="Index" class="btn btn-secondary">← Quay lại danh sách</a>
</p>

